import{R as m,j as o,P as h,S as d,q as v,t as S,I as y,x as j,z as g,D as A,E as F}from"./index-DuNZrJSF.js";import{C as E}from"./Close-DJDotPOx.js";import{u as B,h as P}from"./FilterField-DCOQx3bV.js";import{C as b}from"./DataGrid-CaRxL72P.js";import{u as w}from"./useQuery-DRq1iigL.js";const O=({header:e="Filters",grouped:i=!0,onChange:n,onClose:c,config:u,children:r,...l})=>{const{activeFilters:t,dispatch:s}=B();let a=0;m.Children.forEach(r,p=>{if(m.isValidElement(p)&&p.props.field&&P(t.find(x=>x.field===p.props.field)))return a++});const f=()=>{s({type:"SET_ACTIVE_FILTERS",payload:[]})};return o.jsx(h,{elevation:0,variant:"outlined",...l,children:o.jsxs(d,{spacing:0,children:[e&&o.jsxs(d,{direction:"row",spacing:0,alignItems:"center",sx:{borderBottom:"1px solid",borderBottomColor:"grey.300",paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1},children:[o.jsxs(d,{direction:"row",spacing:2,flex:1,children:[o.jsx(v,{children:e}),a>0&&o.jsx(b,{label:`${a} active`,color:"primary",size:"small"})]}),o.jsx(S,{variant:"outlined",onClick:f,sx:{marginRight:1},children:"Reset"}),o.jsx(y,{onClick:c,children:o.jsx(E,{})})]}),i&&o.jsx(d,{spacing:0,children:r}),!i&&o.jsx(d,{spacing:2,sx:{padding:2},children:r})]})})},k=(e,i)=>{let n=e;return i&&(n=e.filter(c=>JSON.stringify(c).toLowerCase().indexOf(i.toLowerCase())>-1)),n},q=(e,i,n)=>{let c=e;if(e&&i.length>0){const u={};i.forEach(r=>{if(n){const l=n.find(t=>t.field===r.field);u[r.field]=l==null?void 0:l.operator}}),c=e.filter(r=>{let l=!0;return i.forEach(t=>{let s=!1;if(l===!0)switch(u[t.field]){case"contains":{r[t.field].indexOf(t.value)>-1&&(s=!0);break}case"contains-one-of":{Array.isArray(t.value)&&t.value.forEach(a=>{s||(Array.isArray(r[t.field])?r[t.field].indexOf(a)>-1&&(s=!0):r[t.field]===a&&(s=!0))});break}case"equals-one-of":{Array.isArray(t.value)&&t.value.forEach(a=>{s||r[t.field]===a&&(s=!0)});break}case"between-inclusive":{if(Array.isArray(t.value)){const a=t.value[0],f=t.value[1];r[t.field]>=a&&r[t.field]<=f&&(s=!0)}break}case"between-dates-inclusive":{if(typeof r[t.field]=="string"&&Array.isArray(t.value)&&t.value[0]&&t.value[1]){const a=j(r[t.field]);a.isAfter(t.value[0])&&a.isBefore(t.value[1])&&(s=!0)}else s=!0;break}}s||(l=!1)}),l})}return c},z=(e,i,n,c)=>{const u=k(e,c);return q(u,i,n)},M=e=>{let i=e.queryMode==="server"?g(e.activeFilters,e.filterConfigs):new URLSearchParams;e.staticParams&&Object.keys(e.staticParams).forEach(s=>{e.staticParams&&i.append(s,e.staticParams[s].toString())}),e.queryMode==="server"&&(i.append("limit",e.pageSize.toString()),i.append("offset",e.offset.toString()));const n=e.queryMode==="server"?[e.dataSource,{...e.activeFilters,pageSize:e.pageSize,offset:e.offset}]:[e.dataSource],{isPending:c,isFetching:u,isError:r,data:l,error:t}=w({queryKey:n,queryFn:async()=>{const s=i.toString();let a=e.dataSource;return s&&s.length>0&&(a=`${e.dataSource}?${s}`),await F(a)},placeholderData:A});return{isPending:c,isFetching:u,isError:r,data:l,error:t}};export{O as F,z as f,M as u};
