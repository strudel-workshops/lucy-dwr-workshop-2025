import{R as m,j as o,P as x,S as d,B as v,t as S,w as y,y as j,D as F,E as g,F as A}from"./index-BeqI0qV9.js";import{C as B}from"./Close-B9AsIFdK.js";import{u as E,h as w}from"./FilterField-HL7RIs9X.js";import{C as P}from"./DataGrid-D7ZpFv6m.js";import{u as b}from"./useQuery-h7DefPpA.js";const I=({header:e="Filters",grouped:i=!0,onChange:n,onClose:c,config:u,children:r,...l})=>{const{activeFilters:t,dispatch:s}=E();let a=0;m.Children.forEach(r,p=>{if(m.isValidElement(p)&&p.props.field&&w(t.find(h=>h.field===p.props.field)))return a++});const f=()=>{s({type:"SET_ACTIVE_FILTERS",payload:[]})};return o.jsx(x,{elevation:0,variant:"outlined",...l,children:o.jsxs(d,{spacing:0,children:[e&&o.jsxs(d,{direction:"row",spacing:0,alignItems:"center",sx:{borderBottom:"1px solid",borderBottomColor:"grey.300",paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1},children:[o.jsxs(d,{direction:"row",spacing:2,flex:1,children:[o.jsx(v,{children:e}),a>0&&o.jsx(P,{label:`${a} active`,color:"primary",size:"small"})]}),o.jsx(S,{variant:"outlined",onClick:f,sx:{marginRight:1},children:"Reset"}),o.jsx(y,{onClick:c,children:o.jsx(B,{})})]}),i&&o.jsx(d,{spacing:0,children:r}),!i&&o.jsx(d,{spacing:2,sx:{padding:2},children:r})]})})},k=(e,i)=>{let n=e;return i&&(n=e.filter(c=>JSON.stringify(c).toLowerCase().indexOf(i.toLowerCase())>-1)),n},R=(e,i,n)=>{let c=e;if(e&&i.length>0){const u={};i.forEach(r=>{if(n){const l=n.find(t=>t.field===r.field);u[r.field]=l==null?void 0:l.operator}}),c=e.filter(r=>{let l=!0;return i.forEach(t=>{let s=!1;if(l===!0)switch(u[t.field]){case"contains":{r[t.field].indexOf(t.value)>-1&&(s=!0);break}case"contains-one-of":{Array.isArray(t.value)&&t.value.forEach(a=>{s||(Array.isArray(r[t.field])?r[t.field].indexOf(a)>-1&&(s=!0):r[t.field]===a&&(s=!0))});break}case"equals-one-of":{Array.isArray(t.value)&&t.value.forEach(a=>{s||r[t.field]===a&&(s=!0)});break}case"between-inclusive":{if(Array.isArray(t.value)){const a=t.value[0],f=t.value[1];r[t.field]>=a&&r[t.field]<=f&&(s=!0)}break}case"between-dates-inclusive":{if(typeof r[t.field]=="string"&&Array.isArray(t.value)&&t.value[0]&&t.value[1]){const a=j(r[t.field]);a.isAfter(t.value[0])&&a.isBefore(t.value[1])&&(s=!0)}else s=!0;break}}s||(l=!1)}),l})}return c},z=(e,i,n,c)=>{const u=k(e,c);return R(u,i,n)},M=e=>{let i=e.queryMode==="server"?F(e.activeFilters,e.filterConfigs):new URLSearchParams;e.staticParams&&Object.keys(e.staticParams).forEach(s=>{e.staticParams&&i.append(s,e.staticParams[s].toString())}),e.queryMode==="server"&&(i.append("limit",e.pageSize.toString()),i.append("offset",e.offset.toString()));const n=e.queryMode==="server"?[e.dataSource,{...e.activeFilters,pageSize:e.pageSize,offset:e.offset}]:[e.dataSource],{isPending:c,isFetching:u,isError:r,data:l,error:t}=b({queryKey:n,queryFn:async()=>{const s=i.toString();let a=e.dataSource;return s&&s.length>0&&(a=`${e.dataSource}?${s}`),await A(a)},placeholderData:g});return{isPending:c,isFetching:u,isError:r,data:l,error:t}};export{I as F,z as f,M as u};
